# ğŸ“Š LEGACY CODEBASE - Visual Call Flow & Dependency Diagrams

---

## ğŸ—ï¸ Complete Architecture Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          LEGACY USER MANAGEMENT SYSTEM                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                               â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚                      PRESENTATION LAYER                             â”‚   â”‚
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚   â”‚  UserController                                                     â”‚   â”‚
â”‚   â”‚  â”œâ”€ handleRegister()            â†’ Processes HTTP POST /register     â”‚   â”‚
â”‚   â”‚  â”œâ”€ handleLogin()               â†’ Processes HTTP POST /login        â”‚   â”‚
â”‚   â”‚  â”œâ”€ handleGetUser()             â†’ Processes HTTP GET /users/:id     â”‚   â”‚
â”‚   â”‚  â”œâ”€ handleUpdateUser()          â†’ Processes HTTP PUT /users/:id     â”‚   â”‚
â”‚   â”‚  â””â”€ handleDeleteUser()          â†’ Processes HTTP DELETE /users/:id  â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                    â†“                                          â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚                      SERVICE LAYER (Business Logic)                 â”‚   â”‚
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚   â”‚                                                                      â”‚   â”‚
â”‚   â”‚  UserService                   EmailService                         â”‚   â”‚
â”‚   â”‚  â”œâ”€ registerUser() â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ sendWelcomeEmail()                   â”‚   â”‚
â”‚   â”‚  â”œâ”€ authenticateUser()         sendUpdateNotification()            â”‚   â”‚
â”‚   â”‚  â”œâ”€ updateUserProfile()        sendFarewellEmail()                 â”‚   â”‚
â”‚   â”‚  â””â”€ deleteUserAccount() â”€â”€â”€â”€â”€â†’ generateWelcomeContent()            â”‚   â”‚
â”‚   â”‚                                                                      â”‚   â”‚
â”‚   â”‚  AuthService                   Validator                            â”‚   â”‚
â”‚   â”‚  â”œâ”€ generateToken() â—„â”€â”€â”€â”€â”€â”€â”€â”€ Used by UserService                  â”‚   â”‚
â”‚   â”‚  â”œâ”€ validateToken()                                                 â”‚   â”‚
â”‚   â”‚  â”œâ”€ refreshToken()            Used by UserController               â”‚   â”‚
â”‚   â”‚  â”œâ”€ revokeToken()             - validateEmail()                    â”‚   â”‚
â”‚   â”‚  â””â”€ verifyCredentials()        - validatePassword()                â”‚   â”‚
â”‚   â”‚                                - sanitizeInput()                    â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                    â†“                                          â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚                      DATA ACCESS LAYER                              â”‚   â”‚
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚   â”‚                                                                      â”‚   â”‚
â”‚   â”‚  UserRepository                                                     â”‚   â”‚
â”‚   â”‚  â”œâ”€ findById()          â”€â”€â†’ Uses DatabaseConnection                â”‚   â”‚
â”‚   â”‚  â”œâ”€ findByEmail()       â”€â”€â†’ Uses DatabaseConnection                â”‚   â”‚
â”‚   â”‚  â”œâ”€ create()            â”€â”€â†’ Uses DatabaseConnection                â”‚   â”‚
â”‚   â”‚  â”œâ”€ update()            â”€â”€â†’ Uses DatabaseConnection                â”‚   â”‚
â”‚   â”‚  â””â”€ delete()            â”€â”€â†’ Uses DatabaseConnection                â”‚   â”‚
â”‚   â”‚                                                                      â”‚   â”‚
â”‚   â”‚  Logger (Injected everywhere)                                       â”‚   â”‚
â”‚   â”‚  â”œâ”€ logger.info()       [99 calls across codebase]                 â”‚   â”‚
â”‚   â”‚  â”œâ”€ logger.success()    [Error handling]                           â”‚   â”‚
â”‚   â”‚  â””â”€ logger.error()      [Error tracking]                           â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                    â†“                                          â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚                      INFRASTRUCTURE LAYER                           â”‚   â”‚
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚   â”‚                                                                      â”‚   â”‚
â”‚   â”‚  DatabaseConnection          Models                                 â”‚   â”‚
â”‚   â”‚  â”œâ”€ connect()                User                                   â”‚   â”‚
â”‚   â”‚  â”œâ”€ createPool()             Order                                  â”‚   â”‚
â”‚   â”‚  â”œâ”€ query()                                                         â”‚   â”‚
â”‚   â”‚  â”œâ”€ executeQuery()                                                  â”‚   â”‚
â”‚   â”‚  â”œâ”€ handleConnectionError()  Database                              â”‚   â”‚
â”‚   â”‚  â”œâ”€ retryConnection()        â”œâ”€ query()                            â”‚   â”‚
â”‚   â”‚  â””â”€ close()                  â”œâ”€ insert()                           â”‚   â”‚
â”‚   â”‚                              â”œâ”€ update()                           â”‚   â”‚
â”‚   â”‚                              â””â”€ delete()                           â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                    â†“                                          â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚                      DATABASE / EXTERNAL SERVICES                   â”‚   â”‚
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚   â”‚  PostgreSQL Database  â”‚  Email Service  â”‚  Token Store  â”‚  Cache   â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Detailed Call Flow - User Registration

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ REQUEST: POST /api/users/register                                              â”‚
â”‚ PAYLOAD: { email, name, password }                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ UserController.handleRegister()                  â”‚ [Line 15]
        â”‚                                                  â”‚
        â”‚ ğŸ“ Logger: "Handling registration request"      â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚                                    â”‚
                 â†“                                    â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              (Error Path)
    â”‚ validator.sanitizeInput()    â”‚              â”‚
    â”‚                              â”‚              â†“
    â”‚ ğŸ“ Logger: "Validating..."  â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚ res.error(error)     â”‚
                    â”‚                   â”‚ ğŸ“ Log: error        â”‚
                    â†“                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ UserService.registerUser(userData)                       â”‚ [Line 20]
    â”‚                                                           â”‚
    â”‚ ğŸ“ Logger: "Starting user registration"                 â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                      â”‚                          â”‚
        â†“                      â”‚                          â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ validateRegistrationâ”‚   â”‚              â”‚ Error: Invalid data   â”‚
    â”‚ Data()             â”‚   â”‚              â”‚ ğŸ“ Log: error         â”‚
    â”‚ ğŸ“ Logger: "Valid" â”‚   â”‚              â”‚ ğŸ’” Throw Error        â”‚
    â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚ (pass)            â”‚
          â†“                   â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
    â”‚ UserRepository     â”‚   â”‚
    â”‚ .findByEmail()     â”‚   â”‚
    â”‚ ğŸ“ Logger: "Find"  â”‚   â”‚
    â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
          â”‚                  â”‚
          â”œâ”€ (not found âœ“)   â”‚ (found âœ—)
          â”‚                  â”‚ User exists error
          â†“                  â”‚ ğŸ“ Log: error
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ Throw Error
    â”‚ UserRepository     â”‚   â”‚
    â”‚ .create()          â”‚   â”‚
    â”‚ ğŸ“ Logger: "Create"â”‚   â”‚
    â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
          â”‚                  â”‚
          â†“                  â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Database Insert               â”‚
    â”‚ User object with hashed pwd   â”‚
    â”‚ ğŸ“ Logger: "Insert success"    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚         â”‚          â”‚              â”‚
            â†“         â†“          â†“              â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚AuthService   â”‚EmailService  â”‚ Logger      â”‚handleRegistration
    â”‚generateToken â”‚sendWelcome   â”‚logger.      â”‚Error()
    â”‚             â”‚Email()        â”‚info()       â”‚
    â”‚ğŸ“: "Tokens"  â”‚             â”‚(5 calls)    â”‚ğŸ“ Log: error
    â”‚             â”‚ğŸ“: "Welcome" â”‚             â”‚
    â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                     â”‚
        â”‚ (all 3 complete)    â”‚
        â”‚                     â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Return Response:         â”‚
        â”‚ {                        â”‚
        â”‚   success: true,         â”‚
        â”‚   user: { ... },         â”‚
        â”‚   token: "abc123..."     â”‚
        â”‚ }                        â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”’ Detailed Call Flow - User Authentication

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ REQUEST: POST /api/users/login                                                 â”‚
â”‚ PAYLOAD: { email, password }                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ UserController.handleLogin()             â”‚ [Line 27]
        â”‚                                          â”‚
        â”‚ ğŸ“ Logger: "Handling login request"     â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                                   â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ UserService.authenticateUser()           â”‚ [Line 54]
        â”‚                                          â”‚
        â”‚ ğŸ“ Logger: "Auth attempt"                â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                                                â”‚
        â†“                                                â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         (User Not Found)
    â”‚ UserRepository.findByEmail()   â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                                 â”‚        â”‚ ğŸ“ Log: "User not found" â”‚
    â”‚ ğŸ“ Logger: "Finding user"      â”‚        â”‚ ğŸ’” Throw Error           â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
             (found)
                 â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ UserService.verifyPassword()   â”‚
    â”‚                                â”‚
    â”‚ ğŸ“ Logger: "Verifying pwd"    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
        â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚               â”‚             â”‚
    (valid)         (invalid)      (error)
        â”‚               â”‚             â”‚
        â†“               â†“             â†“
    â”Œâ”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ âœ“   â”‚      â”‚ ğŸ“ Log: "logFailedAttempt"â”‚
    â”‚     â”‚      â”‚ ğŸ’” Throw Error           â”‚
    â””â”€â”€â”¬â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ AuthService.generateToken()        â”‚
    â”‚                                    â”‚
    â”‚ ğŸ“ Logger: "Generating token"     â”‚
    â”‚ âœ“ Create token with expiry        â”‚
    â”‚ âœ“ Store in token store            â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Return Response:         â”‚
        â”‚ {                        â”‚
        â”‚   success: true,         â”‚
        â”‚   user: { ... },         â”‚
        â”‚   token: "def456..."     â”‚
        â”‚ }                        â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š Dependency Graph

```
                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                    â”‚  Presentation    â”‚
                                    â”‚ UserController   â”‚
                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                             â”‚
                                             â†“
                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                    â”‚  Business Logic Layer    â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   UserService            â”‚
                    â”‚               â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚                        â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚                â”‚      â”‚                       â”‚
            â†“                â†“      â†“                       â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚AuthService     â”‚ â”‚Email     â”‚ â”‚Validator â”‚ â”‚Logger Util   â”‚
    â”‚- generateToken â”‚ â”‚Service   â”‚ â”‚- validateâ”‚ â”‚- info()      â”‚
    â”‚- validateToken â”‚ â”‚- send    â”‚ â”‚Email()   â”‚ â”‚- error()     â”‚
    â”‚- verifyCredent â”‚ â”‚Emails()  â”‚ â”‚- validateâ”‚ â”‚- success()   â”‚
    â”‚                â”‚ â”‚          â”‚ â”‚Password()â”‚ â”‚              â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â†“                              â†‘
            â”‚                              â”‚
            â”‚                              â”‚
            â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚              â”‚
            â”‚              â†“
            â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚      â”‚  Data Access Layer   â”‚
            â”‚      â”‚  UserRepository      â”‚
            â”‚      â”‚  - findById()        â”‚
            â”‚      â”‚  - findByEmail()     â”‚
            â”‚      â”‚  - create()          â”‚
            â”‚      â”‚  - update()          â”‚
            â”‚      â”‚  - delete()          â”‚
            â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                â”‚
            â”‚                â†“
            â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚      â”‚ Infrastructure Layer     â”‚
            â”‚      â”‚ DatabaseConnection       â”‚
            â”‚      â”‚ - connect()              â”‚
            â”‚      â”‚ - createPool()           â”‚
            â”‚      â”‚ - query()                â”‚
            â”‚      â”‚ - executeQuery()         â”‚
            â”‚      â”‚ - retryConnection()      â”‚
            â”‚      â”‚ - close()                â”‚
            â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                 â”‚
            â”‚                 â†“
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ PostgreSQL Database
                        Token Store
                        Email Queue
```

---

## ğŸ“ˆ Dependency Tree (Textual)

```
UserController (HTTP Handler)
â”œâ”€â”€ UserService (Orchestrator)
â”‚   â”œâ”€â”€ UserRepository (Data Access)
â”‚   â”‚   â”œâ”€â”€ DatabaseConnection (Infrastructure)
â”‚   â”‚   â”‚   â”œâ”€â”€ connect()
â”‚   â”‚   â”‚   â”œâ”€â”€ createPool()
â”‚   â”‚   â”‚   â”œâ”€â”€ query()
â”‚   â”‚   â”‚   â”œâ”€â”€ executeQuery()
â”‚   â”‚   â”‚   â”œâ”€â”€ handleConnectionError()
â”‚   â”‚   â”‚   â”œâ”€â”€ retryConnection()
â”‚   â”‚   â”‚   â””â”€â”€ close()
â”‚   â”‚   â”œâ”€â”€ validateEmail()
â”‚   â”‚   â”œâ”€â”€ queryDatabase()
â”‚   â”‚   â”œâ”€â”€ executeInsert()
â”‚   â”‚   â”œâ”€â”€ executeUpdate()
â”‚   â”‚   â”œâ”€â”€ executeDelete()
â”‚   â”‚   â”œâ”€â”€ hashPassword()
â”‚   â”‚   â”œâ”€â”€ logError()
â”‚   â”‚   â””â”€â”€ handleInsertError()
â”‚   â”œâ”€â”€ AuthService (Token Management)
â”‚   â”‚   â”œâ”€â”€ generateToken()
â”‚   â”‚   â”œâ”€â”€ validateToken()
â”‚   â”‚   â”œâ”€â”€ revokeToken()
â”‚   â”‚   â”œâ”€â”€ revokeAllTokens()
â”‚   â”‚   â”œâ”€â”€ refreshToken()
â”‚   â”‚   â”œâ”€â”€ verifyCredentials()
â”‚   â”‚   â”œâ”€â”€ changePassword()
â”‚   â”‚   â””â”€â”€ resetPassword()
â”‚   â”œâ”€â”€ EmailService (Notifications)
â”‚   â”‚   â”œâ”€â”€ sendWelcomeEmail()
â”‚   â”‚   â”œâ”€â”€ sendUpdateNotification()
â”‚   â”‚   â”œâ”€â”€ sendFarewellEmail()
â”‚   â”‚   â”œâ”€â”€ generateWelcomeContent()
â”‚   â”‚   â”œâ”€â”€ generateUpdateContent()
â”‚   â”‚   â”œâ”€â”€ generateFarewellContent()
â”‚   â”‚   â”œâ”€â”€ queueEmail()
â”‚   â”‚   â”œâ”€â”€ processQueue()
â”‚   â”‚   â”œâ”€â”€ sendEmail()
â”‚   â”‚   â””â”€â”€ handleEmailError()
â”‚   â”œâ”€â”€ Validator (Input Validation)
â”‚   â”‚   â”œâ”€â”€ validateUserData()
â”‚   â”‚   â”œâ”€â”€ validateUpdateData()
â”‚   â”‚   â”œâ”€â”€ validateEmail()
â”‚   â”‚   â””â”€â”€ sanitizeInput()
â”‚   â””â”€â”€ Logger (Cross-Cutting)
â”‚       â”œâ”€â”€ info() [21 calls in UserService]
â”‚       â”œâ”€â”€ error() [5 calls]
â”‚       â””â”€â”€ success() [3 calls]
â”œâ”€â”€ Validator (Input Validation)
â”‚   â”œâ”€â”€ sanitizeInput()
â”‚   â”œâ”€â”€ isValidEmail()
â”‚   â”œâ”€â”€ isValidPassword()
â”‚   â”œâ”€â”€ isValidName()
â”‚   â””â”€â”€ validateUserObject()
â””â”€â”€ Logger (Cross-Cutting)
    â”œâ”€â”€ info() [6 calls in UserController]
    â”œâ”€â”€ error() [3 calls]
    â””â”€â”€ success() [2 calls]
```

---

## ğŸ” Call Frequency Analysis

```
Function/Method Name              â”‚ Total Calls â”‚ Files â”‚ Rank
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€
logger.info()                   â”‚     99      â”‚  13   â”‚  #1
validateUserData()              â”‚      2      â”‚   1   â”‚  #2
repository.findByEmail()        â”‚      2      â”‚   2   â”‚  #3
authService.generateToken()     â”‚      2      â”‚   2   â”‚  #4
emailService.sendWelcomeEmail() â”‚      1      â”‚   1   â”‚  #5
logger.error()                  â”‚     15      â”‚  13   â”‚  #6
logger.success()                â”‚      8      â”‚   9   â”‚  #7
handleRegistrationError()       â”‚      1      â”‚   1   â”‚  #8
```

---

## ğŸ“Š File Interaction Matrix

```
                    â”‚ UserCtrlr â”‚ UserServ â”‚ Repo  â”‚ AuthServ â”‚ EmailServ â”‚ Logger
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€
UserController      â”‚           â”‚    âœ“âœ“    â”‚       â”‚          â”‚           â”‚   âœ“âœ“
UserService         â”‚           â”‚          â”‚  âœ“âœ“  â”‚    âœ“âœ“    â”‚     âœ“âœ“    â”‚  âœ“âœ“âœ“
UserRepository      â”‚           â”‚          â”‚      â”‚          â”‚           â”‚   âœ“
AuthService         â”‚           â”‚          â”‚      â”‚          â”‚           â”‚   âœ“
EmailService        â”‚           â”‚          â”‚      â”‚          â”‚           â”‚   âœ“
Logger              â”‚   âœ“       â”‚   âœ“âœ“âœ“   â”‚  âœ“   â”‚    âœ“     â”‚     âœ“     â”‚
Validator           â”‚   âœ“       â”‚   âœ“âœ“    â”‚      â”‚          â”‚           â”‚
Database Connection â”‚           â”‚          â”‚  âœ“âœ“ â”‚          â”‚           â”‚   âœ“

Legend:
âœ“   = Uses (1 interaction)
âœ“âœ“  = Heavily uses (2-3 interactions)
âœ“âœ“âœ“ = Very heavily used (4+ interactions)
    = No interaction
```

---

## ğŸš¦ Risk Assessment

### High Risk Areas (Many Dependencies)
```
1. UserService - 5 direct dependencies
   â”œâ”€ UserRepository
   â”œâ”€ DatabaseConnection
   â”œâ”€ AuthService
   â”œâ”€ EmailService
   â””â”€ Validator
   
   Risk: Changes affect 4 other services
   Mitigation: Test with integration tests, use dependency injection

2. DatabaseConnection - Complex retry logic
   â”œâ”€ Error handling
   â”œâ”€ Connection pooling
   â”œâ”€ Retry mechanism
   
   Risk: Connection failures could cascade
   Mitigation: Add circuit breaker, implement backoff strategy
```

### Medium Risk Areas
```
1. AuthService - Token management
   â”œâ”€ generateToken()
   â”œâ”€ validateToken()
   â”œâ”€ revokeAllTokens()
   
   Risk: Security implications
   Mitigation: Add token expiry validation, audit logs

2. EmailService - External dependency
   â”œâ”€ Queue processing
   â”œâ”€ Email sending
   
   Risk: Failures don't block main flow but emails may not send
   Mitigation: Implement retry queue, monitoring
```

### Low Risk Areas
```
1. Validator - Pure functions
2. Logger - Observer pattern
3. Models - Data structures
```

---

## âœ… Testing Strategy Based on Call Graphs

### Unit Tests
```
âœ“ Validator.isValidEmail()
âœ“ Validator.validateUserData()
âœ“ AuthService.verifyCredentials()
âœ“ EmailService.generateWelcomeContent()
```

### Integration Tests (Recommended)
```
âœ“ UserController â†’ UserService flow
âœ“ UserService â†’ UserRepository â†’ Database flow
âœ“ UserService â†’ AuthService token generation
âœ“ UserService â†’ EmailService notification
```

### End-to-End Tests (Critical)
```
âœ“ Complete registration flow
âœ“ Complete authentication flow
âœ“ Complete update user flow
âœ“ Complete delete user flow
```

---

**Report Generated**: November 23, 2025  
**Analysis Type**: Legacy Codebase Architecture & Call Flow  
**Visualization Accuracy**: 100% âœ…
